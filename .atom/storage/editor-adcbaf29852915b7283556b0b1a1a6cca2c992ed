{"mode":"editor","version":1,"windowDimensions":{"x":1139,"y":65,"width":1024,"height":1058},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/kwatanabe/git/whiteplus/hiroie/hiroie_api_develop/api.hiroie.jp/fuel/app/tasks","buffers":[{"text":"<?php\n\nnamespace Fuel\\Tasks;\n\nrequire_once APPPATH.'/../packages/apnsphp/ApnsPHP/Autoload.php';\n\nclass ApnsPhpTest\n{\n\tpublic function run()\n\t{\n\t\t$push = new \\ApnsPHP_Push(\n\t\t\t1,\n\t\t\tAPPPATH.'/config/development/hiroie_push_develop.pem'\n\t\t\t);\n\t\t//var_dump($push);\n\t\t\n\t\t\n\n\t\t$push->connect();\n\n\t\t$this->real_message($push,0,3);\n\t\t/*\n\t\t$this->dummy_messsage($push);\t\t\n\n\t\t$this->real_message($push,3,3);\n\n\t\t$this->dummy_messsage($push);\t\t\n\n\t\t$this->real_message($push,6,3);\n\n\t\t$this->dummy_messsage($push);\t\t\n\n\t\t$this->real_message($push,9,3);\n\t\t*/\n\n\t\t$push->send();\n\t\t$push->disconnect();\n\n\t\t$this->remove_tokens($push->getErrors());\n\t}\n\n\tprivate function real_message($push, $offset, $limit)\n\t{\n\t\t$device_token = 'd64424f325fea6cfa747affabc28bc0cc6bbdebdadf7f2f8732fc213284763c8';\n\t\tfor ($i = $offset; $i <  ($offset + $limit); $i++)\n\t\t{\n\t\t\techo $i;\n\t\t\t$message = new \\ApnsPHP_Message($device_token);\n\t\t\t$message->setText('Test notif #'.$i. '(TIME:'.date('H:i:s').')');\n\t\t\t$message->setExpiry(60*60*24*7);\n\t\t\t$push->add($message);\n\t\t}\n\t}\n\n\tprivate function dummy_messsage($push)\n\t{\n\t\t$dummy_token = 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa';\n\n\t\t$message = new \\ApnsPHP_Message($dummy_token);\n\t\t$message->setText('Test dummy notif'. '(TIME:'.date('H:i:s').')');\n\t\t$message->setExpiry(60*60*24*7);\n\t\t$push->add($message);\n\t}\n\n\tprivate function remove_tokens($error_queues)\n\t{\n\t\t$invalid_tokens = array();\n\t\tforeach($error_queues as $error)\n\t\t{\n\t\t\tif (isset($error['ERRORS']))\n\t\t\t{\n\t\t\t\tforeach ($error['ERRORS'] as $e)\n\t\t\t\t{\t\n\t\t\t\t\tif(isset($e['statusCode']) && $e['statusCode'] == '8')\n\t\t\t\t\t{\n\n                    \t//$invalid_tokens[] = $devices[$e['identifier']-1];\n                    \tvar_dump($error['MESSAGE']->getRecipients()[0]);\n                \t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tforeach ($invalid_tokens as $tokens)\n\t\t{\n\t\t\tvar_dump($tokens);\n\t\t}\n\t}\n}","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":10,"preserveFolds":true,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/kwatanabe/git/whiteplus/hiroie/hiroie_api_develop/api.hiroie.jp/fuel/app/tasks/apnsphptest.php","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"170803341f0b65f68e34deaa7ab0b4132cfd111b","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"items":[{"id":10,"softTabs":false,"scrollTop":0,"scrollLeft":0,"displayBuffer":{"id":11,"softWrap":false,"editorWidthInChars":101,"tokenizedBuffer":{"bufferPath":"/Users/kwatanabe/git/whiteplus/hiroie/hiroie_api_develop/api.hiroie.jp/fuel/app/tasks/apnsphptest.php","tabLength":4,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/kwatanabe/git/whiteplus/hiroie/hiroie_api_develop/api.hiroie.jp/fuel/app/tasks/apnsphptest.php","focused":true,"active":true,"deserializer":"Pane"},"deserializer":"PaneContainer"},"fullScreen":false,"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/kwatanabe/git/whiteplus/hiroie/hiroie_api_develop/api.hiroie.jp/fuel/app/tasks/apnsphptest.php":1397703760087},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":7309},"tree-view":{"directoryExpansionStates":{},"selectedPath":"/Users/kwatanabe/git/whiteplus/hiroie/hiroie_api_develop/api.hiroie.jp/fuel/app/tasks/apnsphptest.php","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}