{"mode":"editor","version":1,"windowDimensions":{"x":68,"y":54,"width":1023,"height":1024},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items","buffers":[{"text":"//\n//  ContentsViewController.h\n//  PCD\n//\n//  Created by Appirits on 12/05/22.\n//  Copyright (c) 2012年 Appirits. All rights reserved.\n//\n\n#import <UIKit/UIKit.h>\n#import <GoogleCast/GoogleCast.h>\n#import \"Item.h\"\n#import \"ItemsListViewController.h\"\n#import \"ItemsGridViewController.h\"\n#import \"ChromecastDeviceController.h\"\n\ntypedef enum {\n    ConnectionTagForPlayMovie = 0,\n    ConnectionTagForGooglecast,\n} ConnectionTag;\n\n@interface ItemsViewController : UIViewController<ChromecastControllerDelegate>\n\n@property (nonatomic, strong) ItemsListViewController *listViewController;\n@property (nonatomic, strong) ItemsGridViewController *gridViewController;\n@property (nonatomic, strong) NSMutableArray *items;\n@property (nonatomic, assign) NSInteger       resultAvailable;\n@property (nonatomic, assign) NSInteger       page;\n@property (nonatomic, assign) ItemSort        sort;\n@property (nonatomic, assign) ItemLoadType    loadType;\n@property (nonatomic, assign) BOOL            isLoading;\n@property (nonatomic, strong) NSURLConnection *connection;\n@property (nonatomic, weak) IBOutlet UIView *toolbar;\n@property (nonatomic, strong) ChromecastDeviceController *chromecastController;\n\n- (void)refreshItems:(NSArray *)items;\n- (void)chooseDevice:(id)sender;\n\n@end\n","markers":{"markers":{"1":{"id":1,"range":[[32,20],[32,20]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":24,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[32,53],[35,55]],"newRange":[[32,53],[32,53]],"oldText":"\n=======\n@property (nonatomic, retain) NSURLConnection *connection;\n@property (nonatomic, retain) IBOutlet UIView *toolbar;","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[29,56],[30,12]],"newRange":[[29,56],[29,56]],"oldText":"\n<<<<<<< HEAD","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[33,0],[33,26]],"newRange":[[33,0],[33,0]],"oldText":">>>>>>> feature/chromecast","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[33,0],[33,0]]},"newParams":{"range":[[32,79],[33,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[32,79],[33,0]],"newRange":[[32,79],[32,79]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[32,22],[32,28]]},"newParams":{"tailed":false,"range":[[32,22],[32,22]]},"deserializer":"MarkerPatch"},{"oldRange":[[32,22],[32,28]],"newRange":[[32,22],[32,23]],"oldText":"retain","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"range":[[32,22],[32,22]]},"newParams":{"range":[[32,23],[32,23]]},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[32,23],[32,23]],"newRange":[[32,23],[32,24]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[32,24],[32,24]],"newRange":[[32,24],[32,25]],"oldText":"","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[32,25],[32,25]],"newRange":[[32,25],[32,26]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[32,26],[32,26]],"newRange":[[32,26],[32,27]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[32,27],[32,27]],"newRange":[[32,27],[32,28]],"oldText":"","newText":"g","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController.h","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"417412253f4927fb35ed159e44c1c02340fd5a2b","deserializer":"TextBuffer"},{"text":"//\n//  ItemsViewController+ItemsViewController_MoviePlayer.h\n//  PCD\n//\n//  Created by Appirits on 12/05/28.\n//  Copyright (c) 2012年 Appirits. All rights reserved.\n//\n\n#import \"ItemsViewController.h\"\n#import <MediaPlayer/MediaPlayer.h>\n\n@interface ItemsViewController (MoviePlayer)\n\n- (void)playMovieWithUrl:(NSString *)fileUrl;\n- (void)addNotifications:(MPMoviePlayerController *)player;\n- (void)removeNotification:(MPMoviePlayerController *)player;\n- (void)moviePlayEnd:(NSNotification *)notification;\n- (void)didFinishMoviewPlayReasonPlaybackError:(MPMoviePlayerController *)player;\n\n@end\n","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":28},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.h","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"d019ab1862b6c4859920509901aad5f353d5d5f3","deserializer":"TextBuffer"},{"text":"//\n//  ItemsViewController+ItemsViewController_MoviePlayer.m\n//  PCD\n//\n//  Created by Appirits on 12/05/28.\n//  Copyright (c) 2012年 Appirits. All rights reserved.\n//\n\n#import \"ItemsViewController+MoviePlayer.h\"\n\n#import \"UtilityAlertView.h\"\n#import \"PCDepotConstants.h\"\n#import \"PCDepotErrorUtils.h\"\n#import \"NSURLConnection+Tag.h\"\n#import \"ItemsViewController+Googlecast.h\"\n\n@implementation ItemsViewController (MoviePlayer)\n\n- (void)getMovieDirectUrl:(NSString *)urlString\n{\n    NSURL *url = [NSURL URLWithString:urlString];\n    NSURLRequest *request = [NSURLRequest requestWithURL:url];\n    NSURLConnection *connection = [[NSURLConnection alloc] initWithRequest:request delegate:self];\n    [connection start];\n    self.connection = connection;\n}\n\n-(NSURLRequest *)connection:(NSURLConnection *)connection willSendRequest:(NSURLRequest *)request redirectResponse:(NSHTTPURLResponse *)redirectResponse\n{\n    if (redirectResponse) {\n        NSString *directURLString = [[request URL] absoluteString];\n        if ([[connection tag] integerValue] == ConnectionTagForGooglecast) {\n            [self googlecastMovieWithDirectUrlString:directURLString];\n        } else {\n            [self playMovieWithDirectUrl:directURLString];\n        }\n        [self.connection setTagNumber:nil];\n        self.connection = nil;\n        return nil;\n    }\n    return request;\n}\n\n- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response\n{\n    NSInteger statusCode = [(NSHTTPURLResponse *)response statusCode];\n    if (statusCode >= 400) {\n        [UtilityAlertView showAlertWithMessage:[PCDepotErrorUtils messageMediaPlayerError]];\n        self.connection = nil;\n    }\n}\n\n-(void)connectionDidFinishLoading:(NSURLConnection*)connection\n{\n    NSURLRequest *request = [connection currentRequest];\n    NSString *directURLString = [[request URL] absoluteString];\n    [self playMovieWithDirectUrl:directURLString];\n    self.connection = nil;\n}\n\n- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error\n{\n    [UtilityAlertView showAlertWithMessage:[PCDepotErrorUtils messageMediaPlayerError]];\n    self.connection = nil;\n}\n\n- (void)playMovieWithUrl:(NSString *)fileUrl\n{\n    NSLog(@\">>>>>> movie file url : %@\", fileUrl);\n    [self getMovieDirectUrl:fileUrl];\n}\n\n- (void)playMovieWithDirectUrl:(NSString *)fileUrl\n{\n    NSLog(@\">>>>>> movie file direct url : %@\", fileUrl);\n    NSURL *url = [NSURL URLWithString:fileUrl];\n    MPMoviePlayerViewController *mpViewController = [[MPMoviePlayerViewController alloc] initWithContentURL:url];\n    MPMoviePlayerController *player = mpViewController.moviePlayer;\n    if ([player respondsToSelector:@selector(setAllowsAirPlay:)]) {\n        player.allowsAirPlay = YES;\n    }\n    [self addNotifications:player];\n    [self presentMoviePlayerViewControllerAnimated:mpViewController];\n}\n\n#pragma mark - setting notification\n\n- (void)addNotifications:(MPMoviePlayerController *)player\n{\n    [[NSNotificationCenter defaultCenter] addObserver:self\n                                             selector:@selector(moviePlayEnd:) \n                                                 name:MPMoviePlayerPlaybackDidFinishNotification object:player];\n}\n\n- (void)removeNotification:(MPMoviePlayerController *)player\n{\n    [[NSNotificationCenter defaultCenter] removeObserver:self\n                                                    name:MPMoviePlayerPlaybackDidFinishNotification\n                                                  object:player];\n}\n\n#pragma mark - Receive Notification\n\n- (void)moviePlayEnd:(NSNotification *)notification\n{\n    MPMoviePlayerController *player = [notification object];\n    [self removeNotification:player];\n    \n    NSDictionary *userInfo = [notification userInfo];\n    int ret = [[userInfo objectForKey:@\"MPMoviePlayerPlaybackDidFinishReasonUserInfoKey\"] intValue];\n    switch (ret) {\n        case MPMovieFinishReasonPlaybackEnded:\n            [player stop];\n            break;\n        case MPMovieFinishReasonPlaybackError:\n            [self didFinishMoviewPlayReasonPlaybackError:player];\n            break;\n        case MPMovieFinishReasonUserExited:\n            [player stop];\n            break;\n        default:\n            break;\n    }\n\n    [self dismissMoviePlayerViewControllerAnimated];\n}\n\n\n- (void)didFinishMoviewPlayReasonPlaybackError:(MPMoviePlayerController *)player\n{\n    [UtilityAlertView showAlertWithMessage:[PCDepotErrorUtils messageMediaPlayerError]];\n}\n\n\n@end\n","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":32},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.m","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"6660eade1e9f06581683592c72e1a854474266d7","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"items":[{"id":24,"softTabs":true,"displayBuffer":{"id":25,"softWrap":false,"editorWidthInChars":89,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController.h","tabLength":4,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":28,"softTabs":false,"displayBuffer":{"id":29,"softWrap":false,"editorWidthInChars":89,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.h","tabLength":4,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":32,"softTabs":true,"displayBuffer":{"id":33,"softWrap":false,"editorWidthInChars":89,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.m","tabLength":4,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.m","focused":false,"active":true,"deserializer":"Pane"},"deserializer":"PaneContainer"},"fullScreen":false,"deserializer":"Workspace"},"packageStates":{"script":{"scriptOptionsViewState":""},"fuzzy-finder":{"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController.h":1402280243646,"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.h":1402280368535,"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.m":1402280369298},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":158631},"tree-view":{"directoryExpansionStates":{},"selectedPath":"/Users/kwatanabe/projects/ios/club_pcdepot/PCD/Classes/Controllers/Items/ItemsViewController+MoviePlayer.m","hasFocus":true,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}