{"mode":"editor","version":1,"windowDimensions":{"x":882,"y":130,"width":1023,"height":1024},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/kwatanabe/git/3d_animation_AR/android_metaio_fragment/src/jp/classmethdo/metaiofragment","buffers":[{"text":"package jp.classmethdo.metaiofragment;\n\nimport android.app.Application;\nimport android.content.res.Configuration;\nimport android.hardware.Camera.CameraInfo;\nimport android.os.Bundle;\nimport android.support.v4.app.Fragment;\nimport android.util.Log;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\n\nimport com.metaio.sdk.MetaioDebug;\nimport com.metaio.sdk.MetaioSurfaceView;\nimport com.metaio.sdk.SensorsComponentAndroid;\nimport com.metaio.sdk.jni.ERENDER_SYSTEM;\nimport com.metaio.sdk.jni.ESCREEN_ROTATION;\nimport com.metaio.sdk.jni.IGeometry;\nimport com.metaio.sdk.jni.IMetaioSDKAndroid;\nimport com.metaio.sdk.jni.IMetaioSDKCallback;\nimport com.metaio.sdk.jni.MetaioSDK;\nimport com.metaio.sdk.jni.Rotation;\nimport com.metaio.sdk.jni.TrackingValuesVector;\nimport com.metaio.sdk.jni.Vector3d;\nimport com.metaio.tools.Screen;\nimport com.metaio.tools.SystemInfo;\nimport com.metaio.tools.io.AssetsManager;\n\npublic class MetaioFragment extends Fragment implements MetaioSurfaceView.Callback{\n\n    /** アプリケーションコンテキスト */\n    private Application mAppContext;\n    /** 最上位のレイアウト（ここに） */\n    private ViewGroup mRootLayout;\n    /** 動画のパス */\n    private String mMoviePath;\n    //--- Metaio関連 ---\n    /** コールバックハンドラ */\n    private MetaioSDKCallbackHandler mCallback;\n    /** Metaioオブジェクト */\n    private IGeometry mMovie;\n    /** metaio SDK object */\n    private IMetaioSDKAndroid mMetaioSDK;\n    /** metaio SurfaceView */\n    private MetaioSurfaceView mSurfaceView;\n    /** Metaioライブラリロードフラグ */\n    private static boolean mNativeLibsLoaded = false;\n    /** レンダリング初期化フラグ */\n    private boolean mRendererInitialized;\n    /** Sensor manager */\n    private SensorsComponentAndroid mSensors;\n    /** ネイティブライブラリを読み込む */\n    static {\n        mNativeLibsLoaded = IMetaioSDKAndroid.loadNativeLibs();\n    }\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Log.d(\"LifeCycle\", \"onCreate\");\n\n        mAppContext = getActivity().getApplication();\n        mMetaioSDK = null;\n        mSurfaceView = null;\n        mRendererInitialized = false;\n        try {\n\n            mCallback = new MetaioSDKCallbackHandler();\n\n            if (!mNativeLibsLoaded){\n                throw new Exception(\"Unsupported platform, failed to load the native libs\");\n            }\n\n            // Create sensors component\n            mSensors = new SensorsComponentAndroid(mAppContext);\n\n            // Create Unifeye Mobile by passing Activity instance and\n            // application signature\n            mMetaioSDK = MetaioSDK.CreateMetaioSDKAndroid(getActivity(), getResources().getString(R.string.metaioSDKSignature));\n            mMetaioSDK.registerSensorsComponent(mSensors);\n\n        } catch (Throwable e) {\n            MetaioDebug.log(Log.ERROR, \"ArCameraFragment.onCreate: failed to create or intialize metaio SDK: \" + e.getMessage());\n            return;\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        Log.d(\"LifeCycle\", \"onCreateView\");\n        View view = inflater.inflate(R.layout.metaio_fragment, container, false);\n        mRootLayout = (ViewGroup)getActivity().findViewById(R.id.root);\n        return view;\n    }\n\n    @Override\n    public void onStart() {\n        super.onStart();\n        Log.d(\"LifeCycle\", \"onStart\");\n\n        if(mMetaioSDK == null){\n            return;\n        }\n        MetaioDebug.log(\"ArCameraFragment.onStart()\");\n\n        try {\n            mSurfaceView = null;\n\n            // Start camera\n            startCamera();\n\n            // Add Unifeye GL Surface view\n            mSurfaceView = new MetaioSurfaceView(mAppContext);\n            mSurfaceView.registerCallback(this);\n            mSurfaceView.setKeepScreenOn(true);\n\n            MetaioDebug.log(\"ArCameraFragment.onStart: addContentView(mMetaioSurfaceView)\");\n            mRootLayout.addView(mSurfaceView, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,\n                    ViewGroup.LayoutParams.WRAP_CONTENT));\n            mSurfaceView.setZOrderMediaOverlay(true);\n\n        } catch (Exception e) {\n            MetaioDebug.log(Log.ERROR, \"Error creating views: \" + e.getMessage());\n            MetaioDebug.printStackTrace(Log.ERROR, e);\n        }\n    }\n\n    /**\n     * Fragment��Resume����.\n     * @see Fragment#onResume\n     */\n    @Override\n    public void onResume() {\n        super.onResume();\n        Log.d(\"LifeCycle\", \"onResume\");\n\n        // make sure to resume the OpenGL surface\n        if (mSurfaceView != null) {\n            mSurfaceView.onResume();\n        }\n\n        if(mMetaioSDK != null){\n            mMetaioSDK.resume();\n        }\n    }\n\n    @Override\n    public void onPause() {\n        super.onPause();\n\n        Log.d(\"LifeCycle\", \"onPause\");\n\n        // pause the OpenGL surface\n        if (mSurfaceView != null) {\n            mSurfaceView.onPause();\n        }\n\n        if (mMetaioSDK != null) {\n            // Disable the camera\n            mMetaioSDK.pause();\n        }\n\n    }\n\n    @Override\n    public void onStop() {\n        super.onStop();\n\n        Log.d(\"LifeCycle\", \"onStop\");\n\n        if (mMetaioSDK != null) {\n            // Disable the camera\n            mMetaioSDK.stopCamera();\n        }\n\n        if (mSurfaceView != null) {\n            mRootLayout.removeView(mSurfaceView);\n        }\n\n        System.runFinalization();\n        System.gc();\n    }\n\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n\n        Log.d(\"LifeCycle\", \"onDestroy\");\n\n        try {\n            mRendererInitialized = false;\n        } catch (Exception e) {\n            MetaioDebug.printStackTrace(Log.ERROR, e);\n        }\n\n        MetaioDebug.log(\"ArCameraFragment.onDestroy\");\n\n        if (mMetaioSDK != null) {\n            mMetaioSDK.delete();\n            mMetaioSDK = null;\n        }\n\n        MetaioDebug.log(\"ArCameraFragment.onDestroy releasing sensors\");\n        if (mSensors != null) {\n            mSensors.registerCallback(null);\n            mSensors.release();\n            mSensors.delete();\n            mSensors = null;\n        }\n\n        // Memory.unbindViews(activity.findViewById(android.R.id.content));\n\n        System.runFinalization();\n        System.gc();\n    }\n\n    @Override\n    public void onConfigurationChanged(Configuration newConfig) {\n        super.onConfigurationChanged(newConfig);\n        final ESCREEN_ROTATION rotation = Screen.getRotation(getActivity());\n        mMetaioSDK.setScreenRotation(rotation);\n        MetaioDebug.log(\"onConfigurationChanged: \" + rotation);\n    }\n\n    @Override\n    public void onDrawFrame() {\n        //\t\tLog.d(\"LifeCycle\", \"onDrawFrame\");\n        if (mRendererInitialized) {\n            mMetaioSDK.render();\n        }\n    }\n\n    @Override\n    public void onSurfaceCreated() {\n        Log.d(\"LifeCycle\", \"onSurfaceCreated\");\n\n        try {\n            if (!mRendererInitialized) {\n                mMetaioSDK.initializeRenderer(mSurfaceView.getWidth(), mSurfaceView.getHeight(), Screen.getRotation(getActivity()),\n                        ERENDER_SYSTEM.ERENDER_SYSTEM_OPENGL_ES_2_0);\n                mRendererInitialized = true;\n            } else {\n                MetaioDebug.log(\"ArCameraFragment.onSurfaceCreated: Reloading textures...\");\n                // mMetaioSDK.reloadTextures();\n            }\n\n            MetaioDebug.log(\"ArCameraFragment.onSurfaceCreated: Registering audio renderer...\");\n            // mMetaioSDK.registerAudioCallback(mSurfaceView.getAudioRenderer());\n            mMetaioSDK.registerCallback(mCallback);\n\n            MetaioDebug.log(\"ARViewActivity.onSurfaceCreated\");\n        } catch (Exception e) {\n            MetaioDebug.log(Log.ERROR, \"ArCameraFragment.onSurfaceCreated: \" + e.getMessage());\n        }\n        // サーフェスビュー初期化が終わったらコンテンツをロード\n        mSurfaceView.queueEvent(new Runnable() {\n            @Override\n            public void run() {\n                loadContents();\n            }\n        });\n\n    }\n\n    private void loadContents() {\n        try {\n            AssetsManager.extractAllAssets(this.getActivity(), true);\n            mMoviePath = AssetsManager.getAssetPath(\"demo_movie.alpha.3g2\");\n            String file = AssetsManager.getAssetPath(\"tracking.zip\");\n            boolean result = mMetaioSDK.setTrackingConfiguration(file);\n\n            mMovie = mMetaioSDK.createGeometryFromMovie(mMoviePath, true);\n            if (mMovie != null) {\n                mMovie.setMovieTexture(mMoviePath, true);\n                MetaioDebug.log(\"Loaded geometry \" + mMovie);\n            } else{\n                MetaioDebug.log(Log.ERROR, \"Error loading geometry: \" + mMovie);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    @Override\n    public void onSurfaceChanged(int width, int height) {\n        Log.d(\"LifeCycle\", \"onSurfaceChanged\");\n\n        mMetaioSDK.resizeRenderer(width, height);\n    }\n\n    @Override\n    public void onSurfaceDestroyed() {\n        Log.d(\"LifeCycle\", \"onSurfaceDestroyed\");\n\n        MetaioDebug.log(\"ArCameraFragment.onSurfaceDestroyed(){\");\n        mSurfaceView = null;\n        // mMetaioSDK.registerAudioCallback(null);\n    }\n\n    /**\n     * カメラを起動する.\n     */\n    protected void startCamera() {\n        final int cameraIndex = SystemInfo.getCameraIndex(CameraInfo.CAMERA_FACING_BACK);\n        if (mMetaioSDK != null) {\n            mMetaioSDK.startCamera(cameraIndex, 640, 480);\n        }\n    }\n\n    /**\n     * Metaio�̃C�x���g�n���h�����W�߂��N���X. \n     */\n    final class MetaioSDKCallbackHandler extends IMetaioSDKCallback {\n\n        /**\n         * マーカーをトラッキングしたときに呼び出される.\n         * @param trackingValues トラッキング情報\n         */\n        @Override\n        public void onTrackingEvent(final TrackingValuesVector trackingValues) {\n            super.onTrackingEvent(trackingValues);\n            if(!trackingValues.isEmpty() && trackingValues.get(0).isTrackingState()){\n                // Movieを表示する\n                mMovie.setMovieTexture(mMoviePath, true);\n                mMovie.setScale(10f);\n                mMovie.setRotation(new Rotation(new Vector3d(0f, 0f, (float)-Math.PI/2)));\n                mMovie.setVisible(true);\n                mMovie.startMovieTexture(true);\n            }\n        }\n    }\t\n}\n","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":7,"goalBufferRange":null},"deserializer":"Marker"},"59":{"id":59,"range":[[29,0],[330,6]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[30,0],[30,0]],"newRange":[[30,0],[52,0]],"oldText":"","newText":"    /** アプリケーションコンテキスト */\n    private Application mAppContext;\n    /** 最上位のレイアウト（ここに） */\n    private ViewGroup mRootLayout;\n    /** 動画のパス */\n    private String mMoviePath;\n    //--- Metaio関連 ---\n    /** コールバックハンドラ */\n    private MetaioSDKCallbackHandler mCallback;\n    /** Metaioオブジェクト */\n    private IGeometry mMovie;\n    /** metaio SDK object */\n    private IMetaioSDKAndroid mMetaioSDK;\n    /** metaio SurfaceView */\n    private MetaioSurfaceView mSurfaceView;\n    /** Metaioライブラリロードフラグ */\n    private static boolean mNativeLibsLoaded = false;\n    /** レンダリング初期化フラグ */\n    private boolean mRendererInitialized;\n    /** Sensor manager */\n    private SensorsComponentAndroid mSensors;\n    /** ネイティブライブラリを読み込む */\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[52,0],[85,0]],"newRange":[[52,0],[52,0]],"oldText":"\t/** �A�v���P�[�V�����R���e�L�X�g */\n\tprivate Application mAppContext;\n\t\n\t/** �ŏ�ʂ̃��C�A�E�g�i�����Ɂj */\n\tprivate ViewGroup mRootLayout;\n\t\n\t/** ����̃p�X */\n\tprivate String mMoviePath;\n\n\t\n\t//--- Metaio�֘A ---\n\t/** �R�[���o�b�N�n���h�� */\n\tprivate MetaioSDKCallbackHandler mCallback;\n\n\t/** Metaio�I�u�W�F�N�g */\n\tprivate IGeometry mMovie;\n\t\n\t/** metaio SDK object */\n\tprivate IMetaioSDKAndroid mMetaioSDK;\n\n\t/** metaio SurfaceView */\n\tprivate MetaioSurfaceView mSurfaceView;\n\n\t/** Metaio���C�u�������[�h�t���O */\n\tprivate static boolean mNativeLibsLoaded = false;\n\n\t/** �����_�����O����t���O */\n\tprivate boolean mRendererInitialized;\n\n\t/** Sensor manager */\n\tprivate SensorsComponentAndroid mSensors;\n\t\n\t/** �l�C�e�B�u���C�u������ǂݍ��� */\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[255,0],[255,0]],"newRange":[[255,0],[256,0]],"oldText":"","newText":"\t\t// サーフェスビュー初期化が終わったらコンテンツをロード\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[256,0],[258,0]],"newRange":[[256,0],[256,0]],"oldText":"\t\t\n\t\t// �T�[�t�F�X�r���[�����I�������R���e���c�����[�h\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[299,0],[299,0]],"newRange":[[299,0],[303,0]],"oldText":"","newText":"\n/**\n* カメラを起動する.\n*/\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[303,0],[307,0]],"newRange":[[303,0],[303,0]],"oldText":"\t\n\t/**\n\t * �J�������N������.\n\t */\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[29,0],[29,0]],"newRange":[[29,0],[30,0]],"oldText":"","newText":"\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[30,0],[31,0]],"newRange":[[30,0],[30,0]],"oldText":"\t\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[52,0],[52,0]],"newRange":[[52,0],[55,0]],"oldText":"","newText":"    static {\n        mNativeLibsLoaded = IMetaioSDKAndroid.loadNativeLibs();\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[55,0],[58,0]],"newRange":[[55,0],[55,0]],"oldText":"\tstatic {\n\t\tmNativeLibsLoaded = IMetaioSDKAndroid.loadNativeLibs();\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[56,0],[56,0]],"newRange":[[56,0],[60,0]],"oldText":"","newText":"    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Log.d(\"LifeCycle\", \"onCreate\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[60,0],[76,0]],"newRange":[[60,0],[60,0]],"oldText":"\t@Override\n\tpublic void onCreate(Bundle savedInstanceState) {\n\t\tsuper.onCreate(savedInstanceState);\n\t\tLog.d(\"LifeCycle\", \"onCreate\");\n\t\t\n\t\tmAppContext = getActivity().getApplication();\n\t\tmMetaioSDK = null;\n\t\tmSurfaceView = null;\n\t\tmRendererInitialized = false;\n\t\ttry {\n\t\t\t\n\t\t\tmCallback = new MetaioSDKCallbackHandler();\n\t\t\t\n\t\t\tif (!mNativeLibsLoaded){\n\t\t\t\tthrow new Exception(\"Unsupported platform, failed to load the native libs\");\n\t\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[61,0],[61,0]],"newRange":[[61,0],[66,0]],"oldText":"","newText":"        mAppContext = getActivity().getApplication();\n        mMetaioSDK = null;\n        mSurfaceView = null;\n        mRendererInitialized = false;\n        try {\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[66,0],[68,0]],"newRange":[[66,0],[66,0]],"oldText":"\t\t\t// Create sensors component\n\t\t\tmSensors = new SensorsComponentAndroid(mAppContext);\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[67,0],[67,0]],"newRange":[[67,0],[68,0]],"oldText":"","newText":"            mCallback = new MetaioSDKCallbackHandler();\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[68,0],[72,0]],"newRange":[[68,0],[68,0]],"oldText":"\t\t\t// Create Unifeye Mobile by passing Activity instance and\n\t\t\t// application signature\n\t\t\tmMetaioSDK = MetaioSDK.CreateMetaioSDKAndroid(getActivity(), getResources().getString(R.string.metaioSDKSignature));\n\t\t\tmMetaioSDK.registerSensorsComponent(mSensors);\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[69,0],[69,0]],"newRange":[[69,0],[72,0]],"oldText":"","newText":"            if (!mNativeLibsLoaded){\n                throw new Exception(\"Unsupported platform, failed to load the native libs\");\n            }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[72,0],[95,0]],"newRange":[[72,0],[72,0]],"oldText":"\t\t} catch (Throwable e) {\n\t\t\tMetaioDebug.log(Log.ERROR, \"ArCameraFragment.onCreate: failed to create or intialize metaio SDK: \" + e.getMessage());\n\t\t\treturn;\n\t\t}\n\t}\n\t\n\t@Override\n\tpublic View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n\t\tLog.d(\"LifeCycle\", \"onCreateView\");\n\t\tView view = inflater.inflate(R.layout.metaio_fragment, container, false);\n\t\tmRootLayout = (ViewGroup)getActivity().findViewById(R.id.root);\n\t\treturn view;\n\t}\n\t\n\t@Override\n\tpublic void onStart() {\n\t\tsuper.onStart();\n\t\tLog.d(\"LifeCycle\", \"onStart\");\n\t\t\n\t\tif(mMetaioSDK == null){\n\t\t\treturn;\n\t\t}\n\t\tMetaioDebug.log(\"ArCameraFragment.onStart()\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[73,0],[73,0]],"newRange":[[73,0],[75,0]],"oldText":"","newText":"            // Create sensors component\n            mSensors = new SensorsComponentAndroid(mAppContext);\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[75,0],[77,0]],"newRange":[[75,0],[75,0]],"oldText":"\t\ttry {\n\t\t\tmSurfaceView = null;\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[76,0],[76,0]],"newRange":[[76,0],[80,0]],"oldText":"","newText":"            // Create Unifeye Mobile by passing Activity instance and\n            // application signature\n            mMetaioSDK = MetaioSDK.CreateMetaioSDKAndroid(getActivity(), getResources().getString(R.string.metaioSDKSignature));\n            mMetaioSDK.registerSensorsComponent(mSensors);\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[80,0],[87,0]],"newRange":[[80,0],[80,0]],"oldText":"\t\t\t// Start camera\n\t\t\tstartCamera();\n\t\t\t\n\t\t\t// Add Unifeye GL Surface view\n\t\t\tmSurfaceView = new MetaioSurfaceView(mAppContext);\n\t\t\tmSurfaceView.registerCallback(this);\n\t\t\tmSurfaceView.setKeepScreenOn(true);\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[81,0],[81,0]],"newRange":[[81,0],[86,0]],"oldText":"","newText":"        } catch (Throwable e) {\n            MetaioDebug.log(Log.ERROR, \"ArCameraFragment.onCreate: failed to create or intialize metaio SDK: \" + e.getMessage());\n            return;\n        }\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[86,0],[90,0]],"newRange":[[86,0],[86,0]],"oldText":"\t\t\tMetaioDebug.log(\"ArCameraFragment.onStart: addContentView(mMetaioSurfaceView)\");\n\t\t\tmRootLayout.addView(mSurfaceView, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,\n\t\t\t\t\tViewGroup.LayoutParams.WRAP_CONTENT));\n\t\t\tmSurfaceView.setZOrderMediaOverlay(true);\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[87,0],[87,0]],"newRange":[[87,0],[94,0]],"oldText":"","newText":"    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        Log.d(\"LifeCycle\", \"onCreateView\");\n        View view = inflater.inflate(R.layout.metaio_fragment, container, false);\n        mRootLayout = (ViewGroup)getActivity().findViewById(R.id.root);\n        return view;\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[94,0],[99,0]],"newRange":[[94,0],[94,0]],"oldText":"\t\t} catch (Exception e) {\n\t\t\tMetaioDebug.log(Log.ERROR, \"Error creating views: \" + e.getMessage());\n\t\t\tMetaioDebug.printStackTrace(Log.ERROR, e);\n\t\t}\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[95,0],[95,0]],"newRange":[[95,0],[99,0]],"oldText":"","newText":"    @Override\n    public void onStart() {\n        super.onStart();\n        Log.d(\"LifeCycle\", \"onStart\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[99,0],[112,0]],"newRange":[[99,0],[99,0]],"oldText":"\t/**\n\t * Fragment��Resume����.\n\t * @see Fragment#onResume\n\t */\n\t@Override\n\tpublic void onResume() {\n\t\tsuper.onResume();\n\t\tLog.d(\"LifeCycle\", \"onResume\");\n\t\t\n\t\t// make sure to resume the OpenGL surface\n\t\tif (mSurfaceView != null) {\n\t\t\tmSurfaceView.onResume();\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[100,0],[100,0]],"newRange":[[100,0],[104,0]],"oldText":"","newText":"        if(mMetaioSDK == null){\n            return;\n        }\n        MetaioDebug.log(\"ArCameraFragment.onStart()\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[104,0],[108,0]],"newRange":[[104,0],[104,0]],"oldText":"\t\tif(mMetaioSDK != null){\n\t\t\tmMetaioSDK.resume();\n\t\t}\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[105,0],[105,0]],"newRange":[[105,0],[107,0]],"oldText":"","newText":"        try {\n            mSurfaceView = null;\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[107,0],[110,0]],"newRange":[[107,0],[107,0]],"oldText":"\t@Override\n\tpublic void onPause() {\n\t\tsuper.onPause();\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[108,0],[108,0]],"newRange":[[108,0],[110,0]],"oldText":"","newText":"            // Start camera\n            startCamera();\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[110,0],[111,0]],"newRange":[[110,0],[110,0]],"oldText":"\t\tLog.d(\"LifeCycle\", \"onPause\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[111,0],[111,0]],"newRange":[[111,0],[115,0]],"oldText":"","newText":"            // Add Unifeye GL Surface view\n            mSurfaceView = new MetaioSurfaceView(mAppContext);\n            mSurfaceView.registerCallback(this);\n            mSurfaceView.setKeepScreenOn(true);\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[115,0],[119,0]],"newRange":[[115,0],[115,0]],"oldText":"\t\t// pause the OpenGL surface\n\t\tif (mSurfaceView != null) {\n\t\t\tmSurfaceView.onPause();\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[116,0],[116,0]],"newRange":[[116,0],[120,0]],"oldText":"","newText":"            MetaioDebug.log(\"ArCameraFragment.onStart: addContentView(mMetaioSurfaceView)\");\n            mRootLayout.addView(mSurfaceView, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT,\n                    ViewGroup.LayoutParams.WRAP_CONTENT));\n            mSurfaceView.setZOrderMediaOverlay(true);\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[120,0],[124,0]],"newRange":[[120,0],[120,0]],"oldText":"\t\tif (mMetaioSDK != null) {\n\t\t\t// Disable the camera\n\t\t\tmMetaioSDK.pause();\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[121,0],[121,0]],"newRange":[[121,0],[126,0]],"oldText":"","newText":"        } catch (Exception e) {\n            MetaioDebug.log(Log.ERROR, \"Error creating views: \" + e.getMessage());\n            MetaioDebug.printStackTrace(Log.ERROR, e);\n        }\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[126,0],[127,0]],"newRange":[[126,0],[126,0]],"oldText":"\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[127,0],[127,0]],"newRange":[[127,0],[135,0]],"oldText":"","newText":"    /**\n     * Fragment��Resume����.\n     * @see Fragment#onResume\n     */\n    @Override\n    public void onResume() {\n        super.onResume();\n        Log.d(\"LifeCycle\", \"onResume\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[135,0],[138,0]],"newRange":[[135,0],[135,0]],"oldText":"\t@Override\n\tpublic void onStop() {\n\t\tsuper.onStop();\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[136,0],[136,0]],"newRange":[[136,0],[140,0]],"oldText":"","newText":"        // make sure to resume the OpenGL surface\n        if (mSurfaceView != null) {\n            mSurfaceView.onResume();\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[140,0],[141,0]],"newRange":[[140,0],[140,0]],"oldText":"\t\tLog.d(\"LifeCycle\", \"onStop\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[141,0],[141,0]],"newRange":[[141,0],[145,0]],"oldText":"","newText":"        if(mMetaioSDK != null){\n            mMetaioSDK.resume();\n        }\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[145,0],[149,0]],"newRange":[[145,0],[145,0]],"oldText":"\t\tif (mMetaioSDK != null) {\n\t\t\t// Disable the camera\n\t\t\tmMetaioSDK.stopCamera();\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[146,0],[146,0]],"newRange":[[146,0],[149,0]],"oldText":"","newText":"    @Override\n    public void onPause() {\n        super.onPause();\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[149,0],[152,0]],"newRange":[[149,0],[149,0]],"oldText":"\t\tif (mSurfaceView != null) {\n\t\t\tmRootLayout.removeView(mSurfaceView);\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[150,0],[150,0]],"newRange":[[150,0],[151,0]],"oldText":"","newText":"        Log.d(\"LifeCycle\", \"onPause\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[151,0],[154,0]],"newRange":[[151,0],[151,0]],"oldText":"\t\tSystem.runFinalization();\n\t\tSystem.gc();\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[152,0],[152,0]],"newRange":[[152,0],[156,0]],"oldText":"","newText":"        // pause the OpenGL surface\n        if (mSurfaceView != null) {\n            mSurfaceView.onPause();\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[156,0],[161,0]],"newRange":[[156,0],[156,0]],"oldText":"\t@Override\n\tpublic void onDestroy() {\n\t\tsuper.onDestroy();\n\t\t\n\t\tLog.d(\"LifeCycle\", \"onDestroy\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[157,0],[157,0]],"newRange":[[157,0],[161,0]],"oldText":"","newText":"        if (mMetaioSDK != null) {\n            // Disable the camera\n            mMetaioSDK.pause();\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[161,0],[166,0]],"newRange":[[161,0],[161,0]],"oldText":"\t\ttry {\n\t\t\tmRendererInitialized = false;\n\t\t} catch (Exception e) {\n\t\t\tMetaioDebug.printStackTrace(Log.ERROR, e);\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[162,0],[162,0]],"newRange":[[162,0],[163,0]],"oldText":"","newText":"    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[163,0],[164,0]],"newRange":[[163,0],[163,0]],"oldText":"\t\tMetaioDebug.log(\"ArCameraFragment.onDestroy\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[164,0],[164,0]],"newRange":[[164,0],[167,0]],"oldText":"","newText":"    @Override\n    public void onStop() {\n        super.onStop();\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[167,0],[171,0]],"newRange":[[167,0],[167,0]],"oldText":"\t\tif (mMetaioSDK != null) {\n\t\t\tmMetaioSDK.delete();\n\t\t\tmMetaioSDK = null;\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[168,0],[168,0]],"newRange":[[168,0],[169,0]],"oldText":"","newText":"        Log.d(\"LifeCycle\", \"onStop\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[169,0],[176,0]],"newRange":[[169,0],[169,0]],"oldText":"\t\tMetaioDebug.log(\"ArCameraFragment.onDestroy releasing sensors\");\n\t\tif (mSensors != null) {\n\t\t\tmSensors.registerCallback(null);\n\t\t\tmSensors.release();\n\t\t\tmSensors.delete();\n\t\t\tmSensors = null;\n\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[170,0],[170,0]],"newRange":[[170,0],[174,0]],"oldText":"","newText":"        if (mMetaioSDK != null) {\n            // Disable the camera\n            mMetaioSDK.stopCamera();\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[174,0],[175,0]],"newRange":[[174,0],[174,0]],"oldText":"\t\t// Memory.unbindViews(activity.findViewById(android.R.id.content));\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[175,0],[175,0]],"newRange":[[175,0],[178,0]],"oldText":"","newText":"        if (mSurfaceView != null) {\n            mRootLayout.removeView(mSurfaceView);\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[178,0],[181,0]],"newRange":[[178,0],[178,0]],"oldText":"\t\tSystem.runFinalization();\n\t\tSystem.gc();\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[179,0],[179,0]],"newRange":[[179,0],[182,0]],"oldText":"","newText":"        System.runFinalization();\n        System.gc();\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[182,0],[189,0]],"newRange":[[182,0],[182,0]],"oldText":"\t@Override\n\tpublic void onConfigurationChanged(Configuration newConfig) {\n\t\tsuper.onConfigurationChanged(newConfig);\n\t\tfinal ESCREEN_ROTATION rotation = Screen.getRotation(getActivity());\n\t\tmMetaioSDK.setScreenRotation(rotation);\n\t\tMetaioDebug.log(\"onConfigurationChanged: \" + rotation);\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[183,0],[183,0]],"newRange":[[183,0],[186,0]],"oldText":"","newText":"    @Override\n    public void onDestroy() {\n        super.onDestroy();\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[186,0],[193,0]],"newRange":[[186,0],[186,0]],"oldText":"\t@Override\n\tpublic void onDrawFrame() {\n//\t\tLog.d(\"LifeCycle\", \"onDrawFrame\");\n\t\tif (mRendererInitialized) {\n\t\t\tmMetaioSDK.render();\n\t\t}\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[187,0],[187,0]],"newRange":[[187,0],[188,0]],"oldText":"","newText":"        Log.d(\"LifeCycle\", \"onDestroy\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[188,0],[191,0]],"newRange":[[188,0],[188,0]],"oldText":"\t@Override\n\tpublic void onSurfaceCreated() {\n\t\tLog.d(\"LifeCycle\", \"onSurfaceCreated\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[189,0],[189,0]],"newRange":[[189,0],[194,0]],"oldText":"","newText":"        try {\n            mRendererInitialized = false;\n        } catch (Exception e) {\n            MetaioDebug.printStackTrace(Log.ERROR, e);\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[194,0],[204,0]],"newRange":[[194,0],[194,0]],"oldText":"\t\ttry {\n\t\t\tif (!mRendererInitialized) {\n\t\t\t\tmMetaioSDK.initializeRenderer(mSurfaceView.getWidth(), mSurfaceView.getHeight(), Screen.getRotation(getActivity()),\n\t\t\t\t\t\tERENDER_SYSTEM.ERENDER_SYSTEM_OPENGL_ES_2_0);\n\t\t\t\tmRendererInitialized = true;\n\t\t\t} else {\n\t\t\t\tMetaioDebug.log(\"ArCameraFragment.onSurfaceCreated: Reloading textures...\");\n\t\t\t\tmMetaioSDK.\n\t\t\t\tmMetaioSDK.reloadTextures();\n\t\t\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[195,0],[195,0]],"newRange":[[195,0],[196,0]],"oldText":"","newText":"        MetaioDebug.log(\"ArCameraFragment.onDestroy\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[196,0],[199,0]],"newRange":[[196,0],[196,0]],"oldText":"\t\t\tMetaioDebug.log(\"ArCameraFragment.onSurfaceCreated: Registering audio renderer...\");\n\t\t\tmMetaioSDK.registerAudioCallback(mSurfaceView.getAudioRenderer());\n\t\t\tmMetaioSDK.registerCallback(mCallback);\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[197,0],[197,0]],"newRange":[[197,0],[201,0]],"oldText":"","newText":"        if (mMetaioSDK != null) {\n            mMetaioSDK.delete();\n            mMetaioSDK = null;\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[201,0],[212,0]],"newRange":[[201,0],[201,0]],"oldText":"\t\t\tMetaioDebug.log(\"ARViewActivity.onSurfaceCreated\");\n\t\t} catch (Exception e) {\n\t\t\tMetaioDebug.log(Log.ERROR, \"ArCameraFragment.onSurfaceCreated: \" + e.getMessage());\n\t\t}\n\t\t// サーフェスビュー初期化が終わったらコンテンツをロード\n\t\tmSurfaceView.queueEvent(new Runnable() {\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\tloadContents();\n\t\t\t}\n\t\t});\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[202,0],[202,0]],"newRange":[[202,0],[209,0]],"oldText":"","newText":"        MetaioDebug.log(\"ArCameraFragment.onDestroy releasing sensors\");\n        if (mSensors != null) {\n            mSensors.registerCallback(null);\n            mSensors.release();\n            mSensors.delete();\n            mSensors = null;\n        }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[209,0],[210,0]],"newRange":[[209,0],[209,0]],"oldText":"\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[210,0],[210,0]],"newRange":[[210,0],[211,0]],"oldText":"","newText":"        // Memory.unbindViews(activity.findViewById(android.R.id.content));\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[211,0],[229,0]],"newRange":[[211,0],[211,0]],"oldText":"\tprivate void loadContents() {\n\t\ttry {\n\t\t\tAssetsManager.extractAllAssets(this.getActivity(), true);\n\t\t\tmMoviePath = AssetsManager.getAssetPath(\"demo_movie.alpha.3g2\");\n\t\t\tString file = AssetsManager.getAssetPath(\"tracking.zip\");\n\t\t\tboolean result = mMetaioSDK.setTrackingConfiguration(file);\n\t\t\t\n\t\t\tmMovie = mMetaioSDK.createGeometryFromMovie(mMoviePath, true);\n\t\t\tif (mMovie != null) {\n\t\t\t\tmMovie.setMovieTexture(mMoviePath, true);\n\t\t\t\tMetaioDebug.log(\"Loaded geometry \" + mMovie);\n\t\t\t} else{\n\t\t\t\tMetaioDebug.log(Log.ERROR, \"Error loading geometry: \" + mMovie);\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[212,0],[212,0]],"newRange":[[212,0],[215,0]],"oldText":"","newText":"        System.runFinalization();\n        System.gc();\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[215,0],[218,0]],"newRange":[[215,0],[215,0]],"oldText":"\t@Override\n\tpublic void onSurfaceChanged(int width, int height) {\n\t\tLog.d(\"LifeCycle\", \"onSurfaceChanged\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[216,0],[216,0]],"newRange":[[216,0],[223,0]],"oldText":"","newText":"    @Override\n    public void onConfigurationChanged(Configuration newConfig) {\n        super.onConfigurationChanged(newConfig);\n        final ESCREEN_ROTATION rotation = Screen.getRotation(getActivity());\n        mMetaioSDK.setScreenRotation(rotation);\n        MetaioDebug.log(\"onConfigurationChanged: \" + rotation);\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[223,0],[225,0]],"newRange":[[223,0],[223,0]],"oldText":"\t\tmMetaioSDK.resizeRenderer(width, height);\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[224,0],[224,0]],"newRange":[[224,0],[231,0]],"oldText":"","newText":"    @Override\n    public void onDrawFrame() {\n        //\t\tLog.d(\"LifeCycle\", \"onDrawFrame\");\n        if (mRendererInitialized) {\n            mMetaioSDK.render();\n        }\n    }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[231,0],[234,0]],"newRange":[[231,0],[231,0]],"oldText":"\t@Override\n\tpublic void onSurfaceDestroyed() {\n\t\tLog.d(\"LifeCycle\", \"onSurfaceDestroyed\");\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[232,0],[232,0]],"newRange":[[232,0],[235,0]],"oldText":"","newText":"    @Override\n    public void onSurfaceCreated() {\n        Log.d(\"LifeCycle\", \"onSurfaceCreated\");\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[235,0],[239,0]],"newRange":[[235,0],[235,0]],"oldText":"\t\tMetaioDebug.log(\"ArCameraFragment.onSurfaceDestroyed(){\");\n\t\tmSurfaceView = null;\n\t\tmMetaioSDK.registerAudioCallback(null);\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[236,0],[236,0]],"newRange":[[236,0],[246,0]],"oldText":"","newText":"        try {\n            if (!mRendererInitialized) {\n                mMetaioSDK.initializeRenderer(mSurfaceView.getWidth(), mSurfaceView.getHeight(), Screen.getRotation(getActivity()),\n                        ERENDER_SYSTEM.ERENDER_SYSTEM_OPENGL_ES_2_0);\n                mRendererInitialized = true;\n            } else {\n                MetaioDebug.log(\"ArCameraFragment.onSurfaceCreated: Reloading textures...\");\n                mMetaioSDK.\n                mMetaioSDK.reloadTextures();\n            }\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[246,0],[255,0]],"newRange":[[246,0],[246,0]],"oldText":"/**\n* カメラを起動する.\n*/\n\tprotected void startCamera() {\n\t\tfinal int cameraIndex = SystemInfo.getCameraIndex(CameraInfo.CAMERA_FACING_BACK);\n\t\tif (mMetaioSDK != null) {\n\t\t\tmMetaioSDK.startCamera(cameraIndex, 640, 480);\n\t\t}\n\t}\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[247,0],[247,0]],"newRange":[[247,0],[250,0]],"oldText":"","newText":"            MetaioDebug.log(\"ArCameraFragment.onSurfaceCreated: Registering audio renderer...\");\n            mMetaioSDK.registerAudioCallback(mSurfaceView.getAudioRenderer());\n            mMetaioSDK.registerCallback(mCallback);\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[250,0],[254,0]],"newRange":[[250,0],[250,0]],"oldText":"\t/**\n\t * Metaio�̃C�x���g�n���h�����W�߂��N���X. \n\t */\n\tfinal class MetaioSDKCallbackHandler extends IMetaioSDKCallback {\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[251,0],[251,0]],"newRange":[[251,0],[332,0]],"oldText":"","newText":"            MetaioDebug.log(\"ARViewActivity.onSurfaceCreated\");\n        } catch (Exception e) {\n            MetaioDebug.log(Log.ERROR, \"ArCameraFragment.onSurfaceCreated: \" + e.getMessage());\n        }\n        // サーフェスビュー初期化が終わったらコンテンツをロード\n        mSurfaceView.queueEvent(new Runnable() {\n            @Override\n            public void run() {\n                loadContents();\n            }\n        });\n\n    }\n\n    private void loadContents() {\n        try {\n            AssetsManager.extractAllAssets(this.getActivity(), true);\n            mMoviePath = AssetsManager.getAssetPath(\"demo_movie.alpha.3g2\");\n            String file = AssetsManager.getAssetPath(\"tracking.zip\");\n            boolean result = mMetaioSDK.setTrackingConfiguration(file);\n\n            mMovie = mMetaioSDK.createGeometryFromMovie(mMoviePath, true);\n            if (mMovie != null) {\n                mMovie.setMovieTexture(mMoviePath, true);\n                MetaioDebug.log(\"Loaded geometry \" + mMovie);\n            } else{\n                MetaioDebug.log(Log.ERROR, \"Error loading geometry: \" + mMovie);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    @Override\n    public void onSurfaceChanged(int width, int height) {\n        Log.d(\"LifeCycle\", \"onSurfaceChanged\");\n\n        mMetaioSDK.resizeRenderer(width, height);\n    }\n\n    @Override\n    public void onSurfaceDestroyed() {\n        Log.d(\"LifeCycle\", \"onSurfaceDestroyed\");\n\n        MetaioDebug.log(\"ArCameraFragment.onSurfaceDestroyed(){\");\n        mSurfaceView = null;\n        mMetaioSDK.registerAudioCallback(null);\n    }\n\n    /**\n     * カメラを起動する.\n     */\n    protected void startCamera() {\n        final int cameraIndex = SystemInfo.getCameraIndex(CameraInfo.CAMERA_FACING_BACK);\n        if (mMetaioSDK != null) {\n            mMetaioSDK.startCamera(cameraIndex, 640, 480);\n        }\n    }\n\n    /**\n     * Metaio�̃C�x���g�n���h�����W�߂��N���X. \n     */\n    final class MetaioSDKCallbackHandler extends IMetaioSDKCallback {\n\n        /**\n         * マーカーをトラッキングしたときに呼び出される.\n         * @param trackingValues トラッキング情報\n         */\n        @Override\n        public void onTrackingEvent(final TrackingValuesVector trackingValues) {\n            super.onTrackingEvent(trackingValues);\n            if(!trackingValues.isEmpty() && trackingValues.get(0).isTrackingState()){\n                // Movieを表示する\n                mMovie.setMovieTexture(mMoviePath, true);\n                mMovie.setScale(10f);\n                mMovie.setRotation(new Rotation(new Vector3d(0f, 0f, (float)-Math.PI/2)));\n                mMovie.setVisible(true);\n                mMovie.startMovieTexture(true);\n            }\n        }\n    }\t\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[332,0],[349,0]],"newRange":[[332,0],[332,0]],"oldText":"\t\t/**\n\t\t * �}�[�J�[���g���b�L���O�����Ƃ��ɌĂяo�����.\n\t\t * @param trackingValues �g���b�L���O���\n\t\t */\n\t\t@Override\n\t\tpublic void onTrackingEvent(final TrackingValuesVector trackingValues) {\n\t\t\tsuper.onTrackingEvent(trackingValues);\n\t\t\tif(!trackingValues.isEmpty() && trackingValues.get(0).isTrackingState()){\n\t\t\t\t// Movie��\\������\n\t\t\t\tmMovie.setMovieTexture(mMoviePath, true);\n\t\t\t\tmMovie.setScale(10f);\n\t\t\t\tmMovie.setRotation(new Rotation(new Vector3d(0f, 0f, (float)-Math.PI/2)));\n\t\t\t\tmMovie.setVisible(true);\n\t\t\t\tmMovie.startMovieTexture(true);\n\t\t\t}\n\t\t}\n\t}\t\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[243,0],[244,0]],"newRange":[[243,0],[243,0]],"oldText":"                mMetaioSDK.\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[243,0],[243,0]],"newRange":[[243,0],[244,0]],"oldText":"","newText":"                // mMetaioSDK.reloadTextures();\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[244,0],[245,0]],"newRange":[[244,0],[244,0]],"oldText":"                mMetaioSDK.reloadTextures();\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[247,0],[247,0]],"newRange":[[247,0],[248,0]],"oldText":"","newText":"            // mMetaioSDK.registerAudioCallback(mSurfaceView.getAudioRenderer());\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[248,0],[249,0]],"newRange":[[248,0],[248,0]],"oldText":"            mMetaioSDK.registerAudioCallback(mSurfaceView.getAudioRenderer());\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[296,0],[296,0]],"newRange":[[296,0],[297,0]],"oldText":"","newText":"        // mMetaioSDK.registerAudioCallback(null);\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[297,0],[298,0]],"newRange":[[297,0],[297,0]],"oldText":"        mMetaioSDK.registerAudioCallback(null);\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/kwatanabe/git/3d_animation_AR/android_metaio_fragment/src/jp/classmethdo/metaiofragment/MetaioFragment.java","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"5b4dfa5afa8912b3b0c2dd61333c7f57800b0fd6","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":7,"softTabs":false,"displayBuffer":{"id":8,"softWrap":false,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/kwatanabe/git/3d_animation_AR/android_metaio_fragment/src/jp/classmethdo/metaiofragment/MetaioFragment.java","tabLength":4,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/kwatanabe/git/3d_animation_AR/android_metaio_fragment/src/jp/classmethdo/metaiofragment/MetaioFragment.java","focused":false,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-java"],"deserializer":"Workspace"},"packageStates":{"script":{"scriptOptionsViewState":""},"fuzzy-finder":{"/Users/kwatanabe/git/3d_animation_AR/android_metaio_fragment/src/jp/classmethdo/metaiofragment/MetaioFragment.java":1407920982227},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":3093033},"tree-view":{"directoryExpansionStates":{},"selectedPath":"/Users/kwatanabe/git/3d_animation_AR/android_metaio_fragment/src/jp/classmethdo/metaiofragment/MetaioFragment.java","hasFocus":true,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}